<section class="mb-16 animate-fade-in">
  <div class="flex flex-col lg:flex-row lg:items-center justify-between gap-4 mb-8">
    <div>
      <h2 class="text-2xl lg:text-3xl font-bold text-gray-900 dark:text-white mb-2">
        Interactive Architecture Diagram
      </h2>
      <p class="text-gray-600 dark:text-gray-400">
        Visual representation of system components and their interactions
      </p>
    </div>

    <div class="flex flex-wrap gap-3">
      <button
        (click)="toggleSimulation()"
        [class]="simulationActive ? 'btn-primary' : 'btn-secondary'"
        class="text-sm px-4 py-2"
      >
        {{ simulationActive ? '‚è∏Ô∏è Stop Simulation' : '‚ñ∂Ô∏è Start Simulation' }}
      </button>
      <button (click)="resetView()" class="btn-secondary text-sm px-4 py-2">üîÑ Reset View</button>
    </div>
  </div>

  <div class="card border-gradient-primary overflow-hidden transition-all duration-300">
    <div class="p-6 border-b border-gray-200 dark:border-gray-800">
      <div class="flex flex-wrap items-center justify-between gap-4">
        <div class="flex items-center gap-3">
          <div class="w-3 h-3 rounded-full bg-emerald-500 animate-pulse"></div>
          <span class="text-sm font-medium text-gray-700 dark:text-gray-300">
            Live Diagram ‚Ä¢ {{ nodes.length }} Components ‚Ä¢ {{ connections.length }} Connections
          </span>
        </div>

        <div class="flex items-center gap-4">
          <div class="hidden md:flex items-center gap-2">
            <span class="text-xs text-gray-500 dark:text-gray-400">Zoom:</span>
            <span class="text-sm font-medium text-gray-700 dark:text-gray-300">
              {{ (scale * 100).toFixed(0) }}%
            </span>
          </div>
          <div class="text-xs text-gray-500 dark:text-gray-400">
            üñ±Ô∏è Scroll to zoom ‚Ä¢ Click & drag to pan
          </div>
        </div>
      </div>
    </div>

    <!-- Diagram Container -->
    <!--
    <div
      class="relative w-full aspect-[32/18] bg-gradient-to-br from-gray-50 to-gray-100 dark:from-gray-900 dark:to-gray-800 overflow-hidden"
      (mousedown)="onPanStart($event)"
      (mousemove)="onPanMove($event)"
      (mouseup)="onPanEnd()"
      (mouseleave)="onPanEnd()"
    >
      <div class="absolute inset-0 opacity-20 dark:opacity-10">
        <div class="w-full h-full grid-pattern"></div>
      </div>

      <svg
        class="absolute inset-0 w-full h-full"
        [attr.viewBox]="viewBox"
        preserveAspectRatio="xMidYMid meet"
      >
        <defs>
          <marker
            id="arrowhead"
            markerWidth="6"
            markerHeight="6"
            refX="5"
            refY="3"
            orient="auto"
            markerUnits="strokeWidth"
          >
            <polygon points="0 0, 6 3, 0 6" class="fill-gray-400 dark:fill-gray-600" />
          </marker>

          <linearGradient id="connection-gradient" x1="0%" y1="0%" x2="100%" y2="0%">
            <stop offset="0%" class="stop-color-emerald-400" />
            <stop offset="100%" class="stop-color-blue-400" />
          </linearGradient>
        </defs>

        <g class="connections">
          @for (conn of connections; track conn.id) {
          <g
            (mouseenter)="hoveredConnection = conn.id"
            (mouseleave)="hoveredConnection = null"
            class="transition-opacity duration-300"
            [class.opacity-100]="
              hoveredConnection === conn.id ||
              selectedNode?.id === conn.from ||
              selectedNode?.id === conn.to
            "
            [class.opacity-40]="
              hoveredConnection !== conn.id &&
              selectedNode &&
              selectedNode.id !== conn.from &&
              selectedNode.id !== conn.to
            "
          >
            <line
              [attr.x1]="getNodeX(conn.from)"
              [attr.y1]="getNodeY(conn.from)"
              [attr.x2]="getNodeX(conn.to)"
              [attr.y2]="getNodeY(conn.to)"
              [class]="
                conn.isActive
                  ? 'stroke-blue-400 dark:stroke-blue-500'
                  : 'stroke-gray-300 dark:stroke-gray-700'
              "
              class="stroke-1 transition-all duration-300"
              [class.stroke-[2]]="hoveredConnection === conn.id"
              stroke-dasharray="4,2"
              marker-end="url(#arrowhead)"
            />

            <text
              [attr.x]="getConnectionMidpoint(conn, 'x')"
              [attr.y]="getConnectionMidpoint(conn, 'y') - 2"
              text-anchor="middle"
              class="text-[3px] fill-current text-gray-600 dark:text-gray-400 font-medium pointer-events-none"
            >
              {{ conn.protocol }}
            </text>
          </g>
          }
        </g>

        <g class="nodes">
          @for (node of nodes; track node.id) {
          <g
            (click)="selectNode(node)"
            class="cursor-pointer transition-all duration-300"
            [class.scale-110]="selectedNode?.id === node.id"
            [class.opacity-40]="selectedNode && selectedNode.id !== node.id"
          >
            @if (node.status === 'warning' || node.status === 'error') { <circle [attr.cx]="node.x"
            [attr.cy]="node.y" r="8" class="animate-pulse" [class.fill-rose-500/20]="node.status ===
            'error'" [class.fill-amber-500/20]="node.status === 'warning'" /> }

            <circle
              [attr.cx]="node.x"
              [attr.cy]="node.y"
              r="6"
              [class]="'fill-current text-white dark:text-gray-900'"
            />

            <circle
              [attr.cx]="node.x"
              [attr.cy]="node.y"
              r="6"
              class="fill-none stroke-2"
              [class]="getNodeColor(node.type)"
              [class.stroke-3]="selectedNode?.id === node.id"
            />

            <text
              [attr.x]="node.x"
              [attr.y]="node.y + 2"
              text-anchor="middle"
              class="text-[3px] fill-current text-gray-800 dark:text-gray-200 pointer-events-none"
            >
              {{ getNodeIcon(node.type) }}
            </text>

            <text
              [attr.x]="node.x"
              [attr.y]="node.y - 10"
              text-anchor="middle"
              class="text-[3px] fill-current text-gray-700 dark:text-gray-300 font-semibold pointer-events-none"
            >
              {{ node.label }}
            </text>

            @if (node.traffic && node.traffic > 0) {
            <circle
              [attr.cx]="node.x"
              [attr.cy]="node.y"
              r="3"
              class="fill-emerald-500/50 animate-pulse"
              [style.opacity]="node.traffic / 100"
            />
            }
          </g>
          }
        </g>
      </svg>
      <div class="absolute bottom-4 left-4 right-4">
        <div class="flex flex-wrap justify-center gap-3">
          @for (item of legendItems; track item.type) {
          <div
            class="flex items-center gap-2 px-3 py-1.5 rounded-lg bg-white/80 dark:bg-gray-900/80 backdrop-blur-sm border border-gray-200 dark:border-gray-700"
          >
            <div [ngClass]="item.color" class="w-3 h-3 rounded-full"></div>
            <span class="text-xs font-medium text-gray-700 dark:text-gray-300">
              {{ item.label }}
            </span>
          </div>
          }
        </div>
      </div>
    </div>
  -->
    <div>
      <!-- Placeholder for the diagram SVG or canvas -->
      <div
        class="w-full h-96 flex items-center justify-center text-gray-400 dark:text-gray-600 italic"
      >
        [Architecture Diagram Placeholder]
      </div>
    </div>

    <!-- Selected Node Details Panel -->
    @if (selectedNode) {
    <div class="border-t border-gray-200 dark:border-gray-800 animate-scale-in">
      <div class="p-6 grid md:grid-cols-2 gap-6">
        <!-- Node Info -->
        <div class="space-y-4">
          <div class="flex items-start gap-4">
            <div
              [ngClass]="'bg-gradient-to-br ' + getNodeColor(selectedNode.type)"
              class="w-12 h-12 rounded-xl flex items-center justify-center text-2xl flex-shrink-0 shadow-lg"
            >
              {{ getNodeIcon(selectedNode.type) }}
            </div>

            <div class="flex-1">
              <div class="flex items-center gap-3 mb-2">
                <h3 class="font-bold text-gray-900 dark:text-white text-lg">
                  {{ selectedNode.label }}
                </h3>
                <span
                  [ngClass]="getStatusColor(selectedNode.status)"
                  class="px-2 py-1 rounded-full text-xs font-medium"
                >
                  {{ selectedNode.status || 'healthy' | titlecase }}
                </span>
              </div>

              <p class="text-gray-600 dark:text-gray-400 text-sm">
                {{ getNodeDescription(selectedNode) }}
              </p>

              @if (selectedNode.traffic !== undefined) {
              <div class="mt-3">
                <div
                  class="flex items-center justify-between text-xs text-gray-500 dark:text-gray-400 mb-1"
                >
                  <span>Traffic Load</span>
                  <span>{{ selectedNode.traffic.toFixed(0) }}%</span>
                </div>
                <div class="h-1.5 w-full bg-gray-200 dark:bg-gray-800 rounded-full overflow-hidden">
                  <div
                    [ngClass]="
                      selectedNode.traffic > 80
                        ? 'bg-rose-500'
                        : selectedNode.traffic > 60
                        ? 'bg-amber-500'
                        : 'bg-emerald-500'
                    "
                    class="h-full rounded-full transition-all duration-500"
                    [style.width]="selectedNode.traffic + '%'"
                  ></div>
                </div>
              </div>
              }
            </div>
          </div>
        </div>

        <!-- Connections Info -->
        <div class="space-y-4">
          <h4 class="font-semibold text-gray-900 dark:text-white">
            Connections ({{ getNodeConnections(selectedNode.id).length }})
          </h4>

          <div class="space-y-2 max-h-48 overflow-y-auto pr-2">
            @for (conn of getNodeConnections(selectedNode.id); track conn.id) {
            <div
              class="flex items-center justify-between p-3 rounded-lg bg-gray-50 dark:bg-gray-900/50"
            >
              <div class="flex items-center gap-3">
                <div class="w-2 h-2 rounded-full bg-emerald-500"></div>
                <span class="text-sm font-medium text-gray-700 dark:text-gray-300">
                  {{ conn.from === selectedNode.id ? conn.to : conn.from }}
                </span>
              </div>

              <div class="flex items-center gap-2">
                <span
                  [ngClass]="getProtocolColor(conn.protocol || '')"
                  class="px-2 py-1 rounded text-xs"
                >
                  {{ conn.protocol }}
                </span>
                @if (conn.label) {
                <span class="text-xs text-gray-500 dark:text-gray-400">
                  {{ conn.label }}
                </span>
                }
              </div>
            </div>
            }
          </div>
        </div>
      </div>
    </div>
    }

    <!-- Controls Footer -->
    <div
      class="p-4 border-t border-gray-200 dark:border-gray-800 bg-gradient-to-r from-gray-50 to-blue-50 dark:from-gray-900/50 dark:to-blue-900/10"
    >
      <div class="flex flex-wrap items-center justify-between gap-4">
        <div class="flex items-center gap-3">
          <div class="flex items-center gap-2">
            <div class="w-2 h-2 rounded-full bg-emerald-500"></div>
            <span class="text-xs text-gray-600 dark:text-gray-400">Healthy</span>
          </div>
          <div class="flex items-center gap-2">
            <div class="w-2 h-2 rounded-full bg-amber-500"></div>
            <span class="text-xs text-gray-600 dark:text-gray-400">Warning</span>
          </div>
          <div class="flex items-center gap-2">
            <div class="w-2 h-2 rounded-full bg-rose-500"></div>
            <span class="text-xs text-gray-600 dark:text-gray-400">Error</span>
          </div>
        </div>

        <div class="text-sm text-gray-600 dark:text-gray-400">
          üí°
          <span class="font-medium">{{
            selectedNode ? 'Click elsewhere to deselect' : 'Click any node to inspect'
          }}</span>
        </div>
      </div>
    </div>
  </div>
</section>
